private String wrapText(String text) {
        int maxWidth = chatPanel.getWidth(); // Get current width of chatPanel
        FontMetrics fm = chatPanel.getFontMetrics(new Font("Arial", Font.PLAIN, 14));
        StringBuilder wrappedText = new StringBuilder("<html>");
        String[] words = text.split(" ");
        int lineWidth = 0;
        boolean firstWord = true;

        for (String word : words) {
            int wordWidth = fm.stringWidth(word);
            if (!firstWord && lineWidth + fm.stringWidth(" " + word) > maxWidth) {
                wrappedText.append("<br>");
                lineWidth = 0;
            }
            if (!firstWord) {
                wrappedText.append(" ");
                lineWidth += fm.stringWidth(" ");
            }
            wrappedText.append(word);
            lineWidth += wordWidth;
            firstWord = false;
        }

        return wrappedText.toString();
    }
